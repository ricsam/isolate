# 08-fs.md - @ricsam/isolate-fs Implementation Plan

## Overview

The fs package provides an OPFS-compatible File System Access API for the isolate.

## Implementation Steps

### 1. FileSystemDirectoryHandle
- [ ] kind property ('directory')
- [ ] name property
- [ ] getFileHandle(name, options?) - { create: boolean }
- [ ] getDirectoryHandle(name, options?)
- [ ] removeEntry(name, options?) - { recursive: boolean }
- [ ] resolve(possibleDescendant)
- [ ] entries(), keys(), values() - async iterators
- [ ] Symbol.asyncIterator support

### 2. FileSystemFileHandle
- [ ] kind property ('file')
- [ ] name property
- [ ] getFile() - returns File
- [ ] createWritable(options?) - returns FileSystemWritableFileStream
- [ ] createSyncAccessHandle() - optional, for OPFS

### 3. FileSystemWritableFileStream
- [ ] Extends WritableStream
- [ ] write(data) - string, ArrayBuffer, TypedArray, Blob, or WriteParams
- [ ] seek(position)
- [ ] truncate(size)
- [ ] close()

### 4. navigator.storage Integration
- [ ] navigator.storage.getDirectory() - returns root OPFS directory

### 5. Host Handler Interface
- [ ] Define FileSystemHandler interface
- [ ] All operations proxy to host via callbacks
- [ ] Host implements actual file system (real FS, in-memory, etc.)

## Implementation Notes

All file system operations are async and must be proxied to the host. The handler pattern allows flexible backends:
- Real file system access via Node.js fs
- In-memory file system for testing
- Browser OPFS for web environments

## Test Coverage

- `index.test.ts` - File system API tests
- Integration tests with real file operations

## Dependencies

- `@ricsam/isolate-core`
- `isolated-vm`
